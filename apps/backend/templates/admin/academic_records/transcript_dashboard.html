{% extends "admin/base_site.html" %}

{% load i18n admin_urls static admin_modify
%}

{% block title %}
  Transcript Dashboard | {{ site_title|default:"Django site
  admin" }}
{% endblock %}
{% block extrahead %}
  <style>
    .dashboard-container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--accent-color, #0066cc);
    }

    .stat-card.pending::before {
      background: #fd7e14;
    }

    .stat-card.approved::before {
      background: #28a745;
    }

    .stat-card.in-progress::before {
      background: #0066cc;
    }

    .stat-card.completed::before {
      background: #6f42c1;
    }

    .stat-card.urgent::before {
      background: #dc3545;
    }

    .stat-number {
      font-size: 48px;
      font-weight: bold;
      margin-bottom: 10px;
      color: var(--accent-color, #0066cc);
    }

    .stat-card.pending .stat-number {
      color: #fd7e14;
    }

    .stat-card.approved .stat-number {
      color: #28a745;
    }

    .stat-card.in-progress .stat-number {
      color: #0066cc;
    }

    .stat-card.completed .stat-number {
      color: #6f42c1;
    }

    .stat-card.urgent .stat-number {
      color: #dc3545;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .recent-requests {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .recent-requests h3 {
      background: #f8f9fa;
      margin: 0;
      padding: 20px;
      border-bottom: 1px solid #ddd;
    }

    .request-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .request-item {
      padding: 15px 20px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .request-item:last-child {
      border-bottom: none;
    }

    .request-item:hover {
      background: #f8f9fa;
    }

    .request-info {
      flex: 1;
    }

    .request-student {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .request-details {
      font-size: 12px;
      color: #666;
    }

    .request-status {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: bold;
      text-transform: uppercase;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-approved {
      background: #d4edda;
      color: #155724;
    }

    .status-in-progress {
      background: #cce5ff;
      color: #004085;
    }

    .status-completed {
      background: #e2e6ea;
      color: #495057;
    }

    .status-urgent {
      background: #f8d7da;
      color: #721c24;
    }

    .quick-actions {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .action-buttons {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .action-buttons .button {
      padding: 12px 24px;
      text-decoration: none;
      border-radius: 6px;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .filter-bar {
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    .filter-bar select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .workflow-status {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .workflow-steps {
      display: flex;
      justify-content: space-between;
      position: relative;
      margin: 20px 0;
    }

    .workflow-step {
      text-align: center;
      flex: 1;
      position: relative;
    }

    .workflow-step::after {
      content: '';
      position: absolute;
      top: 20px;
      left: 50%;
      width: 100%;
      height: 2px;
      background: #ddd;
      z-index: -1;
    }

    .workflow-step:last-child::after {
      display: none;
    }

    .step-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #ddd;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 10px;
      font-weight: bold;
    }

    .step-icon.active {
      background: #0066cc;
    }

    .step-icon.completed {
      background: #28a745;
    }

    .step-label {
      font-size: 12px;
      color: #666;
    }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Auto-refresh functionality
      let refreshInterval;

      function startAutoRefresh() {
        refreshInterval = setInterval(() => {
          // Update timestamp
          document.getElementById('last-updated').textContent =
            new Date().toLocaleTimeString();

          // In a real implementation, this would fetch updated data via AJAX
          // For now, just update the timestamp
        }, 30000); // Refresh every 30 seconds
      }

      function stopAutoRefresh() {
        if (refreshInterval) {
          clearInterval(refreshInterval);
        }
      }

      // Start auto-refresh
      startAutoRefresh();

      // Filter functionality
      const statusFilter = document.getElementById('status-filter');
      const typeFilter = document.getElementById('type-filter');
      const urgentFilter = document.getElementById('urgent-filter');

      function applyFilters() {
        const requests = document.querySelectorAll('.request-item');

        requests.forEach((request) => {
          let show = true;

          // Apply status filter
          if (
            statusFilter.value &&
            !request.dataset.status.includes(statusFilter.value)
          ) {
            show = false;
          }

          // Apply type filter
          if (
            typeFilter.value &&
            !request.dataset.type.includes(typeFilter.value)
          ) {
            show = false;
          }

          // Apply urgent filter
          if (
            urgentFilter.value === 'true' &&
            request.dataset.urgent !== 'true'
          ) {
            show = false;
          }

          request.style.display = show ? 'flex' : 'none';
        });
      }

      // Add filter event listeners
      [statusFilter, typeFilter, urgentFilter].forEach((filter) => {
        filter.addEventListener('change', applyFilters);
      });

      // Cleanup on page unload
      window.addEventListener('beforeunload', stopAutoRefresh);
    });

    function refreshDashboard() {
      location.reload();
    }

    function exportTranscriptReport() {
      // Implementation for exporting transcript reports
      window.open('/admin/academic_records/export-report/', '_blank');
    }

    function bulkProcessTranscripts() {
      // Implementation for bulk processing
      if (confirm('Process all approved transcript requests?')) {
        window.location.href = '/admin/academic_records/bulk-process/';
      }
    }
  </script>
{% endblock %}
{% block content %}
  <div class="dashboard-container">
    <h1>Transcript Request Dashboard</h1>
    <div class="stats-grid">
      <div class="stat-card total">
        <div class="stat-number">{{ stats.total }}</div>
        <div class="stat-label">Total Requests</div>
      </div>
      <div class="stat-card pending">
        <div class="stat-number">{{ stats.pending }}</div>
        <div class="stat-label">Pending Approval</div>
      </div>
      <div class="stat-card approved">
        <div class="stat-number">{{ stats.approved }}</div>
        <div class="stat-label">Approved</div>
      </div>
      <div class="stat-card in-progress">
        <div class="stat-number">{{ stats.in_progress }}</div>
        <div class="stat-label">In Progress</div>
      </div>
      <div class="stat-card completed">
        <div class="stat-number">{{ stats.completed }}</div>
        <div class="stat-label">Completed</div>
      </div>
      <div class="stat-card urgent">
        <div class="stat-number">{{ stats.urgent }}</div>
        <div class="stat-label">Urgent Requests</div>
      </div>
    </div>
    <div class="workflow-status">
      <h3>Transcript Processing Workflow</h3>
      <div class="workflow-steps">
        <div class="workflow-step">
          <div class="step-icon completed">1</div>
          <div class="step-label">Request Submitted</div>
        </div>
        <div class="workflow-step">
          <div class="step-icon active">2</div>
          <div class="step-label">Under Review</div>
        </div>
        <div class="workflow-step">
          <div class="step-icon">3</div>
          <div class="step-label">Approved</div>
        </div>
        <div class="workflow-step">
          <div class="step-icon">4</div>
          <div class="step-label">Generated</div>
        </div>
        <div class="workflow-step">
          <div class="step-icon">5</div>
          <div class="step-label">Delivered</div>
        </div>
      </div>
    </div>
    <div class="quick-actions">
      <h3>Quick Actions</h3>
      <div class="action-buttons">
        <a href="{% url 'admin:academic_records_transcriptrequest_changelist' %}"
           class="button">View All Requests</a>
        <a href="{% url 'admin:academic_records_transcriptrequest_add' %}"
           class="button">New Request</a>
        <button type="button"
                class="button default"
                onclick="bulkProcessTranscripts()">Bulk Process</button>
        <button type="button"
                class="button default"
                onclick="exportTranscriptReport()">Export Report</button>
        <button type="button" class="button default" onclick="refreshDashboard()">Refresh Data</button>
      </div>
    </div>
    <div class="filter-bar">
      <label>Filter by Status:</label>
      <select id="status-filter">
        <option value="">All Statuses</option>
        <option value="PENDING">Pending</option>
        <option value="APPROVED">Approved</option>
        <option value="IN_PROGRESS">In Progress</option>
        <option value="COMPLETED">Completed</option>
      </select>
      <label>Filter by Type:</label>
      <select id="type-filter">
        <option value="">All Types</option>
        <option value="OFFICIAL">Official Transcript</option>
        <option value="UNOFFICIAL">Unofficial Transcript</option>
        <option value="DEGREE_AUDIT">Degree Audit</option>
        <option value="GRADE_REPORT">Grade Report</option>
      </select>
      <label>Urgent Only:</label>
      <select id="urgent-filter">
        <option value="">All Requests</option>
        <option value="true">Urgent Only</option>
      </select>
      <div style="margin-left: auto; font-size: 12px; color: #666">
        Last updated: <span id="last-updated">{{ "now"|date:"g:i A" }}</span>
      </div>
    </div>
    <div class="recent-requests">
      <h3>Recent Transcript Requests</h3>
      <div class="request-list">
        {% for request in recent_requests %}
          <div class="request-item"
               data-status="{{ request.request_status }}"
               data-type="{{ request.request_type }}"
               data-urgent="{{ request.urgent_request|yesno:'true,false' }}">
            <div class="request-info">
              <div class="request-student">
                {{ request.student.person.full_name }} ({{
                request.student.student_id }})
              </div>
              <div class="request-details">
                {{ request.get_request_type_display }} • Requested {{
                request.requested_date|date:"M j, Y g:i A" }} • {{
                request.delivery_method|title }}
                {% if request.urgent_request %}
                  🚨{%
                  endif %}
                </div>
              </div>
              <div class="request-status status-{{ request.request_status|lower }}">{{ request.get_request_status_display }}</div>
            </div>
          {% empty %}
            <div class="request-item">
              <div class="request-info">
                <div style="text-align: center; color: #666; padding: 20px">No recent transcript requests found.</div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
      <div style="margin-top: 30px; text-align: center">
        <h3>Transcript Processing Guidelines</h3>
        <ul style="text-align: left; max-width: 600px; margin: 0 auto">
          <li>
            <strong>Standard Processing:</strong> 3-5 business days
          </li>
          <li>
            <strong>Urgent Requests:</strong> 24-48 hours (additional fees may
            apply)
          </li>
          <li>
            <strong>Official Transcripts:</strong> Require manual verification and
            approval
          </li>
          <li>
            <strong>Unofficial Transcripts:</strong> Can be generated immediately
            for current students
          </li>
          <li>
            <strong>Document Security:</strong> All official documents include
            verification codes and watermarks
          </li>
        </ul>
      </div>
      <div style="margin-top: 20px">
        <a href="{% url 'admin:index' %}" class="button">« Back to Admin</a>
      </div>
    </div>
  {% endblock %}
