{% load i18n %}

<form hx-post="{% url 'academic_records:transcript_wizard' %}"
      hx-target="#transcript-wizard-content"
      hx-indicator="#wizard-loading">
  {% csrf_token %}
  
  <div class="space-y-4">
    <!-- Student Selection -->
    <div>
      <label for="student_id" class="block text-sm font-medium text-gray-700">
        {% trans "Student" %}
      </label>
      <select name="student_id" 
              id="student_id"
              required
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
        <option value="">{% trans "Select a student..." %}</option>
        {% for student in students %}
        <option value="{{ student.id }}">
          {{ student.student_id }} - {{ student.person.name_en }}
        </option>
        {% endfor %}
      </select>
    </div>
    
    <!-- Delivery Method -->
    <div>
      <label for="delivery_method" class="block text-sm font-medium text-gray-700">
        {% trans "Delivery Method" %}
      </label>
      <select name="delivery_method" 
              id="delivery_method"
              required
              onchange="toggleDeliveryFields()"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
        <option value="EMAIL">{% trans "Email" %}</option>
        <option value="PICKUP">{% trans "In-Person Pickup" %}</option>
        <option value="MAIL">{% trans "Postal Mail" %}</option>
        <option value="THIRD_PARTY">{% trans "Third Party Institution" %}</option>
      </select>
    </div>
    
    <!-- Email Address (for EMAIL delivery) -->
    <div id="email-field">
      <label for="recipient_email" class="block text-sm font-medium text-gray-700">
        {% trans "Recipient Email" %}
      </label>
      <input type="email"
             name="recipient_email"
             id="recipient_email"
             placeholder="student@example.com"
             class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
    </div>
    
    <!-- Mailing Address (for MAIL delivery) -->
    <div id="address-field" class="hidden">
      <label for="recipient_address" class="block text-sm font-medium text-gray-700">
        {% trans "Mailing Address" %}
      </label>
      <textarea name="recipient_address"
                id="recipient_address"
                rows="3"
                placeholder="{% trans 'Enter complete mailing address...' %}"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"></textarea>
    </div>
    
    <!-- Notes -->
    <div>
      <label for="notes" class="block text-sm font-medium text-gray-700">
        {% trans "Notes" %} <span class="text-gray-400">({% trans "optional" %})</span>
      </label>
      <textarea name="notes"
                id="notes"
                rows="2"
                placeholder="{% trans 'Any special instructions or notes...' %}"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"></textarea>
    </div>
    
    <!-- Fee Information -->
    <div class="bg-blue-50 p-4 rounded-md">
      <div class="flex items-start">
        <div class="flex-shrink-0">
          <i class="fas fa-info-circle text-blue-400"></i>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-blue-800">
            {% trans "Fee Information" %}
          </h3>
          <div class="mt-2 text-sm text-blue-700">
            <p>{% trans "Official transcript fee: $15.00" %}</p>
            <p>{% trans "Students receive 2 free transcripts per academic year." %}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Loading indicator -->
  <div id="wizard-loading" class="hidden text-center py-4">
    <i class="fas fa-spinner fa-spin text-gray-400"></i>
    <div class="text-sm text-gray-500 mt-2">{% trans "Creating transcript request..." %}</div>
  </div>
  
  <!-- Form Actions -->
  <div class="mt-6 flex justify-end space-x-3">
    <button type="button" 
            onclick="closeTranscriptWizard()"
            class="btn btn-secondary">
      {% trans "Cancel" %}
    </button>
    <button type="submit" 
            class="btn btn-primary">
      <i class="fas fa-file-alt mr-2"></i>
      {% trans "Create Request" %}
    </button>
  </div>
</form>

<script>
function toggleDeliveryFields() {
  const method = document.getElementById('delivery_method').value;
  const emailField = document.getElementById('email-field');
  const addressField = document.getElementById('address-field');
  
  // Hide all fields first
  emailField.classList.add('hidden');
  addressField.classList.add('hidden');
  
  // Show relevant field
  if (method === 'EMAIL') {
    emailField.classList.remove('hidden');
    document.getElementById('recipient_email').required = true;
    document.getElementById('recipient_address').required = false;
  } else if (method === 'MAIL' || method === 'THIRD_PARTY') {
    addressField.classList.remove('hidden');
    document.getElementById('recipient_address').required = true;
    document.getElementById('recipient_email').required = false;
  } else {
    // PICKUP - no additional fields needed
    document.getElementById('recipient_email').required = false;
    document.getElementById('recipient_address').required = false;
  }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  toggleDeliveryFields();
});
</script>