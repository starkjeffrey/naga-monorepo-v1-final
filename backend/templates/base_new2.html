{% load static i18n %}

<!DOCTYPE html>
{% get_current_language as LANGUAGE_CODE %}
<html lang="{{ LANGUAGE_CODE }}" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>
      {% block title %}
        {{ system_name|default:"Naga SIS" }}
      {% endblock title %}
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="{% static 'favicon.ico' %}" />
    {% block css %}
      <!-- Tailwind CSS -->
      <script src="https://cdn.tailwindcss.com"></script>
      <!-- Font Awesome -->
      <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
      <!-- Google Fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com" />
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet" />
      <style>
        body {
          font-family: 'Inter', sans-serif;
        }

        /* Smooth transitions for sidebar and content */
        #sidebar,
        #main-content {
          transition: all 0.3s ease-in-out;
        }

        /* Styles for when sidebar is collapsed */
        .sidebar-collapsed #sidebar {
          width: 4.5rem;
          /* 72px */
        }

        .sidebar-collapsed .sidebar-label,
        .sidebar-collapsed .sidebar-header-text {
          display: none;
        }

        .sidebar-collapsed .sidebar-item {
          justify-content: center;
        }

        .sidebar-collapsed #main-content {
          margin-left: 4.5rem;
        }

        @media (max-width: 1024px) {
          .sidebar-collapsed #main-content {
            margin-left: 0;
          }

          .sidebar-collapsed #sidebar {
            transform: translateX(-100%);
          }
        }
      </style>
      {% block extra_css %}
      {% endblock extra_css %}
    {% endblock css %}
  </head>
  <body class="antialiased bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200">
    <div class="relative min-h-screen lg:flex">
      <!-- Sidebar -->
      <aside id="sidebar"
             class="bg-white dark:bg-slate-800 w-64 lg:w-72 flex-shrink-0 fixed lg:relative inset-y-0 left-0 z-30 shadow-lg lg:shadow-none">
        <div class="flex flex-col h-full">
          <!-- Sidebar Header -->
          <div class="h-16 flex items-center justify-center px-4 border-b border-slate-200 dark:border-slate-700">
            <div class="flex items-center space-x-3">
              <div class="h-8 w-8 bg-blue-600 rounded flex items-center justify-center">
                <i class="fas fa-graduation-cap text-white"></i>
              </div>
              <span class="sidebar-header-text font-semibold text-lg">Naga SIS</span>
            </div>
          </div>
          <!-- Navigation Links -->
          <nav class="flex-1 p-4 space-y-2">
            <a href="#"
               class="sidebar-item flex items-center px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">
              <i class="fas fa-home w-6 text-center"></i>
              <span class="ml-3 sidebar-label">Dashboard</span>
            </a>
            <a href="#"
               class="sidebar-item flex items-center px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">
              <i class="fas fa-users w-6 text-center"></i>
              <span class="ml-3 sidebar-label">Students</span>
            </a>
            <a href="#"
               class="sidebar-item flex items-center px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">
              <i class="fas fa-book w-6 text-center"></i>
              <span class="ml-3 sidebar-label">Courses</span>
            </a>
            <a href="#"
               class="sidebar-item flex items-center px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">
              <i class="fas fa-dollar-sign w-6 text-center"></i>
              <span class="ml-3 sidebar-label">Finance</span>
            </a>
          </nav>
        </div>
      </aside>
      <!-- Main Content Area -->
      <div id="main-content" class="flex-1 flex flex-col lg:ml-72">
        <!-- Header -->
        <header class="bg-white dark:bg-slate-800 h-16 flex-shrink-0 border-b border-slate-200 dark:border-slate-700">
          <div class="h-full px-4 lg:px-6 flex items-center justify-between">
            <!-- Left side: Hamburger Menu -->
            <div class="flex items-center">
              <button id="sidebar-toggle"
                      class="p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700">
                <i class="fas fa-bars"></i>
              </button>
            </div>
            <!-- Right side: Actions & User Menu -->
            <div class="flex items-center space-x-4">
              <!-- Messages -->
              <button class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 relative">
                <i class="fas fa-bell"></i>
                <span class="absolute top-1 right-1 h-2 w-2 bg-red-500 rounded-full"></span>
              </button>
              <!-- Language Toggle -->
              <button class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700">
                <i class="fas fa-language"></i>
              </button>
              <!-- Light/Dark Toggle -->
              <button id="theme-toggle"
                      class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700">
                <!-- Icon will be set by JS -->
              </button>
              <!-- User Menu -->
              <div class="flex items-center space-x-3">
                <div class="h-9 w-9 rounded-full bg-slate-300 dark:bg-slate-600 flex items-center justify-center">
                  <i class="fas fa-user text-slate-600 dark:text-slate-300"></i>
                </div>
                <span class="text-sm font-medium hidden sm:block">{{ user.username|default:"Staff Member" }}</span>
              </div>
            </div>
          </div>
        </header>
        <!-- Page Content -->
        <main class="flex-grow p-4 sm:p-6 lg:p-8">
          {% block content %}
          {% endblock content %}
        </main>
      </div>
    </div>
    {% block extra_js %}
      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const sidebarToggle = document.getElementById('sidebar-toggle');
          const themeToggle = document.getElementById('theme-toggle');
          const htmlElement = document.documentElement;
          const bodyElement = document.body;

          const sunIcon = `<i class="fas fa-sun text-yellow-400"></i>`;
          const moonIcon = `<i class="fas fa-moon text-slate-500"></i>`;

          // --- State Initialization ---

          // 1. Theme (Dark/Light Mode)
          const savedTheme = localStorage.getItem('theme') || 'light';
          htmlElement.classList.toggle('dark', savedTheme === 'dark');
          themeToggle.innerHTML = savedTheme === 'dark' ? sunIcon : moonIcon;

          // 2. Sidebar State
          // Collapsed on mobile by default, respects localStorage on desktop
          const isMobile = window.innerWidth < 1024;
          let isSidebarCollapsed = isMobile ? true : localStorage.getItem('sidebarCollapsed') === 'true';
          bodyElement.classList.toggle('sidebar-collapsed', isSidebarCollapsed);

          // --- Event Listeners ---

          // Sidebar Toggle
          if (sidebarToggle) {
            sidebarToggle.addEventListener('click', () => {
              const isCollapsed = bodyElement.classList.toggle('sidebar-collapsed');
              // Only save preference on desktop to avoid overriding mobile-first default
              if (!isMobile) {
                localStorage.setItem('sidebarCollapsed', isCollapsed);
              }
            });
          }

          // Theme Toggle
          if (themeToggle) {
            themeToggle.addEventListener('click', () => {
              const isDark = htmlElement.classList.toggle('dark');
              localStorage.setItem('theme', isDark ? 'dark' : 'light');
              themeToggle.innerHTML = isDark ? sunIcon : moonIcon;
            });
          }
        });
      </script>
    {% endblock extra_js %}
  </body>
</html>
